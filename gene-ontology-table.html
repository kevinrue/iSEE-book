<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Gene ontology table | Extending iSEE</title>
  <meta name="description" content="This book describes how to use the Bioconductor iSEE package to create web-applications for exploring data stored in SummarizedExperiment objects." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Gene ontology table | Extending iSEE" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book describes how to use the Bioconductor iSEE package to create web-applications for exploring data stored in SummarizedExperiment objects." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Gene ontology table | Extending iSEE" />
  
  <meta name="twitter:description" content="This book describes how to use the Bioconductor iSEE package to create web-applications for exploring data stored in SummarizedExperiment objects." />
  

<meta name="author" content="Kevin Rue-Albrecht, Federico Marini, Charlotte Soneson, and Aaron Lun" />


<meta name="date" content="2020-07-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="annotated-gene-list.html"/>
<link rel="next" href="contributors.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Extending <i>iSEE</i></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="part"><span><b>I API overview</b></span></li>
<li class="chapter" data-level="1" data-path="panels.html"><a href="panels.html"><i class="fa fa-check"></i><b>1</b> Panel classes</a><ul>
<li class="chapter" data-level="1.1" data-path="panels.html"><a href="panels.html#overview"><i class="fa fa-check"></i><b>1.1</b> Overview</a></li>
<li class="chapter" data-level="1.2" data-path="panels.html"><a href="panels.html#virtual-classes"><i class="fa fa-check"></i><b>1.2</b> Virtual classes</a><ul>
<li class="chapter" data-level="1.2.1" data-path="panels.html"><a href="panels.html#panel"><i class="fa fa-check"></i><b>1.2.1</b> <code>Panel</code></a></li>
<li class="chapter" data-level="1.2.2" data-path="panels.html"><a href="panels.html#dotplot"><i class="fa fa-check"></i><b>1.2.2</b> <code>DotPlot</code></a></li>
<li class="chapter" data-level="1.2.3" data-path="panels.html"><a href="panels.html#columndotplot"><i class="fa fa-check"></i><b>1.2.3</b> <code>ColumnDotPlot</code></a></li>
<li class="chapter" data-level="1.2.4" data-path="panels.html"><a href="panels.html#rowdotplot"><i class="fa fa-check"></i><b>1.2.4</b> <code>RowDotPlot</code></a></li>
<li class="chapter" data-level="1.2.5" data-path="panels.html"><a href="panels.html#table"><i class="fa fa-check"></i><b>1.2.5</b> <code>Table</code></a></li>
<li class="chapter" data-level="1.2.6" data-path="panels.html"><a href="panels.html#columntable"><i class="fa fa-check"></i><b>1.2.6</b> <code>ColumnTable</code></a></li>
<li class="chapter" data-level="1.2.7" data-path="panels.html"><a href="panels.html#rowtable"><i class="fa fa-check"></i><b>1.2.7</b> <code>RowTable</code></a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="panels.html"><a href="panels.html#concrete-classes"><i class="fa fa-check"></i><b>1.3</b> Concrete classes</a><ul>
<li class="chapter" data-level="1.3.1" data-path="panels.html"><a href="panels.html#reduceddimensionplot"><i class="fa fa-check"></i><b>1.3.1</b> <code>ReducedDimensionPlot</code></a></li>
<li class="chapter" data-level="1.3.2" data-path="panels.html"><a href="panels.html#featureassayplot"><i class="fa fa-check"></i><b>1.3.2</b> <code>FeatureAssayPlot</code></a></li>
<li class="chapter" data-level="1.3.3" data-path="panels.html"><a href="panels.html#columndataplot"><i class="fa fa-check"></i><b>1.3.3</b> <code>ColumnDataPlot</code></a></li>
<li class="chapter" data-level="1.3.4" data-path="panels.html"><a href="panels.html#sampleassayplot"><i class="fa fa-check"></i><b>1.3.4</b> <code>SampleAssayPlot</code></a></li>
<li class="chapter" data-level="1.3.5" data-path="panels.html"><a href="panels.html#rowdataplot"><i class="fa fa-check"></i><b>1.3.5</b> <code>RowDataPlot</code></a></li>
<li class="chapter" data-level="1.3.6" data-path="panels.html"><a href="panels.html#columndatatable"><i class="fa fa-check"></i><b>1.3.6</b> <code>ColumnDataTable</code></a></li>
<li class="chapter" data-level="1.3.7" data-path="panels.html"><a href="panels.html#rowdatatable"><i class="fa fa-check"></i><b>1.3.7</b> <code>RowDataTable</code></a></li>
<li class="chapter" data-level="1.3.8" data-path="panels.html"><a href="panels.html#complexheatmapplot"><i class="fa fa-check"></i><b>1.3.8</b> <code>ComplexHeatmapPlot</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="api.html"><a href="api.html"><i class="fa fa-check"></i><b>2</b> Panel generics</a><ul>
<li class="chapter" data-level="2.1" data-path="panels.html"><a href="panels.html#overview"><i class="fa fa-check"></i><b>2.1</b> Overview</a></li>
<li class="chapter" data-level="2.2" data-path="api.html"><a href="api.html#parameter-set-up"><i class="fa fa-check"></i><b>2.2</b> Parameter set-up</a></li>
<li class="chapter" data-level="2.3" data-path="api.html"><a href="api.html#defining-the-user-interface"><i class="fa fa-check"></i><b>2.3</b> Defining the user interface</a><ul>
<li class="chapter" data-level="2.3.1" data-path="api.html"><a href="api.html#in-general"><i class="fa fa-check"></i><b>2.3.1</b> In general</a></li>
<li class="chapter" data-level="2.3.2" data-path="api.html"><a href="api.html#the-dotplot-visual-interface"><i class="fa fa-check"></i><b>2.3.2</b> The <code>DotPlot</code> visual interface</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="api.html"><a href="api.html#creating-observers"><i class="fa fa-check"></i><b>2.4</b> Creating observers</a></li>
<li class="chapter" data-level="2.5" data-path="api.html"><a href="api.html#defining-panel-outputs"><i class="fa fa-check"></i><b>2.5</b> Defining panel outputs</a><ul>
<li class="chapter" data-level="2.5.1" data-path="api.html"><a href="api.html#in-general-1"><i class="fa fa-check"></i><b>2.5.1</b> In general</a></li>
<li class="chapter" data-level="2.5.2" data-path="api.html"><a href="api.html#for-dotplots"><i class="fa fa-check"></i><b>2.5.2</b> For <code>DotPlot</code>s</a></li>
<li class="chapter" data-level="2.5.3" data-path="api.html"><a href="api.html#for-metadata-dotplots"><i class="fa fa-check"></i><b>2.5.3</b> For metadata <code>DotPlot</code>s</a></li>
<li class="chapter" data-level="2.5.4" data-path="api.html"><a href="api.html#for-tables"><i class="fa fa-check"></i><b>2.5.4</b> For <code>Table</code>s</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="api.html"><a href="api.html#handling-selections"><i class="fa fa-check"></i><b>2.6</b> Handling selections</a><ul>
<li class="chapter" data-level="2.6.1" data-path="api.html"><a href="api.html#multiple"><i class="fa fa-check"></i><b>2.6.1</b> Multiple</a></li>
<li class="chapter" data-level="2.6.2" data-path="api.html"><a href="api.html#single"><i class="fa fa-check"></i><b>2.6.2</b> Single</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="server.html"><a href="server.html"><i class="fa fa-check"></i><b>3</b> Application state</a><ul>
<li class="chapter" data-level="3.1" data-path="panels.html"><a href="panels.html#overview"><i class="fa fa-check"></i><b>3.1</b> Overview</a></li>
<li class="chapter" data-level="3.2" data-path="server.html"><a href="server.html#updating-parameters"><i class="fa fa-check"></i><b>3.2</b> Updating parameters</a></li>
<li class="chapter" data-level="3.3" data-path="server.html"><a href="server.html#using-the-memory"><i class="fa fa-check"></i><b>3.3</b> Using the memory</a></li>
<li class="chapter" data-level="3.4" data-path="server.html"><a href="server.html#responding-to-events"><i class="fa fa-check"></i><b>3.4</b> Responding to events</a></li>
</ul></li>
<li class="part"><span><b>II Worked examples</b></span></li>
<li class="chapter" data-level="4" data-path="developing.html"><a href="developing.html"><i class="fa fa-check"></i><b>4</b> Reduced dimension hexbin plot</a><ul>
<li class="chapter" data-level="4.1" data-path="panels.html"><a href="panels.html#overview"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="developing.html"><a href="developing.html#class-basics"><i class="fa fa-check"></i><b>4.2</b> Class basics</a></li>
<li class="chapter" data-level="4.3" data-path="developing.html"><a href="developing.html#setting-up-the-interface"><i class="fa fa-check"></i><b>4.3</b> Setting up the interface</a></li>
<li class="chapter" data-level="4.4" data-path="developing.html"><a href="developing.html#creating-the-observers"><i class="fa fa-check"></i><b>4.4</b> Creating the observers</a></li>
<li class="chapter" data-level="4.5" data-path="developing.html"><a href="developing.html#generating-the-plot"><i class="fa fa-check"></i><b>4.5</b> Generating the plot</a></li>
<li class="chapter" data-level="4.6" data-path="developing.html"><a href="developing.html#in-action"><i class="fa fa-check"></i><b>4.6</b> In action</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dynamic-reduced-dimensions.html"><a href="dynamic-reduced-dimensions.html"><i class="fa fa-check"></i><b>5</b> Dynamic reduced dimensions</a><ul>
<li class="chapter" data-level="5.1" data-path="panels.html"><a href="panels.html#overview"><i class="fa fa-check"></i><b>5.1</b> Overview</a></li>
<li class="chapter" data-level="5.2" data-path="developing.html"><a href="developing.html#class-basics"><i class="fa fa-check"></i><b>5.2</b> Class basics</a></li>
<li class="chapter" data-level="5.3" data-path="developing.html"><a href="developing.html#setting-up-the-interface"><i class="fa fa-check"></i><b>5.3</b> Setting up the interface</a></li>
<li class="chapter" data-level="5.4" data-path="developing.html"><a href="developing.html#creating-the-observers"><i class="fa fa-check"></i><b>5.4</b> Creating the observers</a></li>
<li class="chapter" data-level="5.5" data-path="dynamic-reduced-dimensions.html"><a href="dynamic-reduced-dimensions.html#making-the-plot"><i class="fa fa-check"></i><b>5.5</b> Making the plot</a></li>
<li class="chapter" data-level="5.6" data-path="developing.html"><a href="developing.html#in-action"><i class="fa fa-check"></i><b>5.6</b> In action</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="dynamic-differential-expression.html"><a href="dynamic-differential-expression.html"><i class="fa fa-check"></i><b>6</b> Dynamic differential expression</a><ul>
<li class="chapter" data-level="6.1" data-path="panels.html"><a href="panels.html#overview"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="developing.html"><a href="developing.html#class-basics"><i class="fa fa-check"></i><b>6.2</b> Class basics</a></li>
<li class="chapter" data-level="6.3" data-path="developing.html"><a href="developing.html#setting-up-the-interface"><i class="fa fa-check"></i><b>6.3</b> Setting up the interface</a></li>
<li class="chapter" data-level="6.4" data-path="developing.html"><a href="developing.html#creating-the-observers"><i class="fa fa-check"></i><b>6.4</b> Creating the observers</a></li>
<li class="chapter" data-level="6.5" data-path="dynamic-differential-expression.html"><a href="dynamic-differential-expression.html#making-the-table"><i class="fa fa-check"></i><b>6.5</b> Making the table</a></li>
<li class="chapter" data-level="6.6" data-path="developing.html"><a href="developing.html#in-action"><i class="fa fa-check"></i><b>6.6</b> In action</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="annotated-gene-list.html"><a href="annotated-gene-list.html"><i class="fa fa-check"></i><b>7</b> Annotated gene list</a><ul>
<li class="chapter" data-level="7.1" data-path="panels.html"><a href="panels.html#overview"><i class="fa fa-check"></i><b>7.1</b> Overview</a></li>
<li class="chapter" data-level="7.2" data-path="developing.html"><a href="developing.html#class-basics"><i class="fa fa-check"></i><b>7.2</b> Class basics</a></li>
<li class="chapter" data-level="7.3" data-path="developing.html"><a href="developing.html#setting-up-the-interface"><i class="fa fa-check"></i><b>7.3</b> Setting up the interface</a></li>
<li class="chapter" data-level="7.4" data-path="developing.html"><a href="developing.html#creating-the-observers"><i class="fa fa-check"></i><b>7.4</b> Creating the observers</a></li>
<li class="chapter" data-level="7.5" data-path="developing.html"><a href="developing.html#in-action"><i class="fa fa-check"></i><b>7.5</b> In action</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="gene-ontology-table.html"><a href="gene-ontology-table.html"><i class="fa fa-check"></i><b>8</b> Gene ontology table</a><ul>
<li class="chapter" data-level="8.1" data-path="panels.html"><a href="panels.html#overview"><i class="fa fa-check"></i><b>8.1</b> Overview</a></li>
<li class="chapter" data-level="8.2" data-path="developing.html"><a href="developing.html#class-basics"><i class="fa fa-check"></i><b>8.2</b> Class basics</a></li>
<li class="chapter" data-level="8.3" data-path="developing.html"><a href="developing.html#setting-up-the-interface"><i class="fa fa-check"></i><b>8.3</b> Setting up the interface</a></li>
<li class="chapter" data-level="8.4" data-path="gene-ontology-table.html"><a href="gene-ontology-table.html#generating-the-output"><i class="fa fa-check"></i><b>8.4</b> Generating the output</a></li>
<li class="chapter" data-level="8.5" data-path="developing.html"><a href="developing.html#creating-the-observers"><i class="fa fa-check"></i><b>8.5</b> Creating the observers</a></li>
<li class="chapter" data-level="8.6" data-path="api.html"><a href="api.html#handling-selections"><i class="fa fa-check"></i><b>8.6</b> Handling selections</a></li>
<li class="chapter" data-level="8.7" data-path="developing.html"><a href="developing.html#in-action"><i class="fa fa-check"></i><b>8.7</b> In action</a></li>
</ul></li>
<li class="part"><span><b>III Appendix</b></span></li>
<li class="chapter" data-level="9" data-path="contributors.html"><a href="contributors.html"><i class="fa fa-check"></i><b>9</b> Contributors</a><ul>
<li><a href="contributors.html#aaron-lun"><em>Aaron Lun</em></a></li>
<li><a href="contributors.html#kevin-rue-albrecht"><em>Kevin Rue-Albrecht</em></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Extending <em>iSEE</em></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="gene-ontology-table" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Gene ontology table</h1>
<div id="overview" class="section level2">
<h2><span class="header-section-number">8.1</span> Overview</h2>
<p>Here, we will construct a table of GO terms where selection of a row in the table
causes transmission of a multiple selection of gene names.
The aim is to enable us to transmit multiple row selections to other panels based on their membership of a gene set.
This is a fairly involved example of creating a <code>Panel</code> subclass as we cannot easily inherit from an existing subclass; rather, we need to provide all the methods ourselves.
Readers may also be interested in the fully fledged version of the proposed class in <em><a href="https://bioconductor.org/packages/3.11/iSEEu">iSEEu</a></em>.</p>
</div>
<div id="class-basics" class="section level2">
<h2><span class="header-section-number">8.2</span> Class basics</h2>
<p>First, we define the basics of our new <code>GOTable</code> class.
This inherits from the virtual base <code>Panel</code> class as it cannot meet any of the contractual requirements of the subclasses,
what with the <code>DataTable</code> selection event triggering a multiple selection rather than a single selection.
We add some slots to specify the feature ID type and the organism of interest as well as for <code>DataTable</code> parameters.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="gene-ontology-table.html#cb204-1"></a><span class="kw">library</span>(iSEE)</span>
<span id="cb204-2"><a href="gene-ontology-table.html#cb204-2"></a><span class="kw">library</span>(S4Vectors)</span>
<span id="cb204-3"><a href="gene-ontology-table.html#cb204-3"></a><span class="kw">setClass</span>(<span class="st">&quot;GOTable&quot;</span>, <span class="dt">contains=</span><span class="st">&quot;Panel&quot;</span>,</span>
<span id="cb204-4"><a href="gene-ontology-table.html#cb204-4"></a>    <span class="dt">slots=</span><span class="kw">c</span>(</span>
<span id="cb204-5"><a href="gene-ontology-table.html#cb204-5"></a>        <span class="dt">IDType=</span><span class="st">&quot;character&quot;</span>,</span>
<span id="cb204-6"><a href="gene-ontology-table.html#cb204-6"></a>        <span class="dt">Organism=</span><span class="st">&quot;character&quot;</span>,</span>
<span id="cb204-7"><a href="gene-ontology-table.html#cb204-7"></a>        <span class="dt">Selected=</span><span class="st">&quot;character&quot;</span>,</span>
<span id="cb204-8"><a href="gene-ontology-table.html#cb204-8"></a>        <span class="dt">Search=</span><span class="st">&quot;character&quot;</span>,</span>
<span id="cb204-9"><a href="gene-ontology-table.html#cb204-9"></a>        <span class="dt">SearchColumns=</span><span class="st">&quot;character&quot;</span></span>
<span id="cb204-10"><a href="gene-ontology-table.html#cb204-10"></a>    )</span>
<span id="cb204-11"><a href="gene-ontology-table.html#cb204-11"></a>)</span></code></pre></div>
<p>We also add some checks for these parameters.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="gene-ontology-table.html#cb205-1"></a>allowable &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ENSEMBL&quot;</span>, <span class="st">&quot;SYMBOL&quot;</span>, <span class="st">&quot;ENTREZID&quot;</span>)</span>
<span id="cb205-2"><a href="gene-ontology-table.html#cb205-2"></a><span class="kw">setValidity2</span>(<span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(object) {</span>
<span id="cb205-3"><a href="gene-ontology-table.html#cb205-3"></a>    msg &lt;-<span class="st"> </span><span class="kw">character</span>(<span class="dv">0</span>)</span>
<span id="cb205-4"><a href="gene-ontology-table.html#cb205-4"></a></span>
<span id="cb205-5"><a href="gene-ontology-table.html#cb205-5"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">isSingleString</span>(orgdb &lt;-<span class="st"> </span>object[[<span class="st">&quot;Organism&quot;</span>]])) {</span>
<span id="cb205-6"><a href="gene-ontology-table.html#cb205-6"></a>        msg &lt;-<span class="st"> </span><span class="kw">c</span>(msg, <span class="kw">sprintf</span>(<span class="st">&quot;&#39;Organism&#39; should be a single string&quot;</span>, orgdb))</span>
<span id="cb205-7"><a href="gene-ontology-table.html#cb205-7"></a>    }</span>
<span id="cb205-8"><a href="gene-ontology-table.html#cb205-8"></a></span>
<span id="cb205-9"><a href="gene-ontology-table.html#cb205-9"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">isSingleString</span>(type &lt;-<span class="st"> </span>object[[<span class="st">&quot;IDType&quot;</span>]]) <span class="op">||</span><span class="st"> </span><span class="op">!</span>type <span class="op">%in%</span><span class="st"> </span>allowable) {</span>
<span id="cb205-10"><a href="gene-ontology-table.html#cb205-10"></a>        msg &lt;-<span class="st"> </span><span class="kw">c</span>(msg, <span class="st">&quot;&#39;IDType&#39; should be &#39;ENSEMBL&#39;, &#39;SYMBOL&#39; or &#39;ENTREZID&#39;&quot;</span>)</span>
<span id="cb205-11"><a href="gene-ontology-table.html#cb205-11"></a>    }</span>
<span id="cb205-12"><a href="gene-ontology-table.html#cb205-12"></a></span>
<span id="cb205-13"><a href="gene-ontology-table.html#cb205-13"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">isSingleString</span>(object[[<span class="st">&quot;Selected&quot;</span>]])) { </span>
<span id="cb205-14"><a href="gene-ontology-table.html#cb205-14"></a>        msg &lt;-<span class="st"> </span><span class="kw">c</span>(msg, <span class="st">&quot;&#39;Selected&#39; should be a single string&quot;</span>)</span>
<span id="cb205-15"><a href="gene-ontology-table.html#cb205-15"></a>    }</span>
<span id="cb205-16"><a href="gene-ontology-table.html#cb205-16"></a></span>
<span id="cb205-17"><a href="gene-ontology-table.html#cb205-17"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">isSingleString</span>(object[[<span class="st">&quot;Search&quot;</span>]])) {</span>
<span id="cb205-18"><a href="gene-ontology-table.html#cb205-18"></a>        msg &lt;-<span class="st"> </span><span class="kw">c</span>(msg, <span class="st">&quot;&#39;Search&#39; should be a single string&quot;</span>)</span>
<span id="cb205-19"><a href="gene-ontology-table.html#cb205-19"></a>    }</span>
<span id="cb205-20"><a href="gene-ontology-table.html#cb205-20"></a></span>
<span id="cb205-21"><a href="gene-ontology-table.html#cb205-21"></a>    <span class="cf">if</span> (<span class="kw">length</span>(msg)) {</span>
<span id="cb205-22"><a href="gene-ontology-table.html#cb205-22"></a>        <span class="kw">return</span>(msg)</span>
<span id="cb205-23"><a href="gene-ontology-table.html#cb205-23"></a>    }</span>
<span id="cb205-24"><a href="gene-ontology-table.html#cb205-24"></a>    <span class="ot">TRUE</span></span>
<span id="cb205-25"><a href="gene-ontology-table.html#cb205-25"></a>})</span></code></pre></div>
<p>We then specialize the initialize method to set reasonable defaults and create an approprpiate constructor.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="gene-ontology-table.html#cb206-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;initialize&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(.Object, </span>
<span id="cb206-2"><a href="gene-ontology-table.html#cb206-2"></a>    <span class="dt">Organism=</span><span class="st">&quot;org.Mm.eg.db&quot;</span>, <span class="dt">IDType=</span><span class="st">&quot;SYMBOL&quot;</span>, </span>
<span id="cb206-3"><a href="gene-ontology-table.html#cb206-3"></a>    <span class="dt">Selected=</span><span class="st">&quot;&quot;</span>, <span class="dt">Search=</span><span class="st">&quot;&quot;</span>, <span class="dt">SearchColumns=</span><span class="kw">character</span>(<span class="dv">0</span>), ...)</span>
<span id="cb206-4"><a href="gene-ontology-table.html#cb206-4"></a>{</span>
<span id="cb206-5"><a href="gene-ontology-table.html#cb206-5"></a>    <span class="kw">callNextMethod</span>(.Object, <span class="dt">IDType=</span>IDType, <span class="dt">Organism=</span>Organism, </span>
<span id="cb206-6"><a href="gene-ontology-table.html#cb206-6"></a>        <span class="dt">Selected=</span>Selected, <span class="dt">Search=</span>Search, </span>
<span id="cb206-7"><a href="gene-ontology-table.html#cb206-7"></a>        <span class="dt">SearchColumns=</span>SearchColumns, ...)</span>
<span id="cb206-8"><a href="gene-ontology-table.html#cb206-8"></a>})</span>
<span id="cb206-9"><a href="gene-ontology-table.html#cb206-9"></a></span>
<span id="cb206-10"><a href="gene-ontology-table.html#cb206-10"></a>GOTable &lt;-<span class="st"> </span><span class="cf">function</span>(...) <span class="kw">new</span>(<span class="st">&quot;GOTable&quot;</span>, ...)</span></code></pre></div>
</div>
<div id="setting-up-the-interface" class="section level2">
<h2><span class="header-section-number">8.3</span> Setting up the interface</h2>
<p>We define the full name and desired default color for display purposes:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="gene-ontology-table.html#cb207-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;.fullName&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x) <span class="st">&quot;Gene ontology table&quot;</span>)</span>
<span id="cb207-2"><a href="gene-ontology-table.html#cb207-2"></a></span>
<span id="cb207-3"><a href="gene-ontology-table.html#cb207-3"></a><span class="kw">setMethod</span>(<span class="st">&quot;.panelColor&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x) <span class="st">&quot;#BB00FF&quot;</span>)</span></code></pre></div>
<p>We add our UI element for showing the gene set table, which is simply a <code>DataTable</code> object from the <em><a href="https://CRAN.R-project.org/package=DT">DT</a></em> package.
Note that <em><a href="https://CRAN.R-project.org/package=shiny">shiny</a></em> also has a <code>dataTableOutput</code> function so care must be taken to disambiguate them.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="gene-ontology-table.html#cb208-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;.defineOutput&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x, ...) {</span>
<span id="cb208-2"><a href="gene-ontology-table.html#cb208-2"></a>    panel_name &lt;-<span class="st"> </span><span class="kw">.getEncodedName</span>(x)</span>
<span id="cb208-3"><a href="gene-ontology-table.html#cb208-3"></a>    <span class="kw">tagList</span>(DT<span class="op">::</span><span class="kw">dataTableOutput</span>(panel_name))</span>
<span id="cb208-4"><a href="gene-ontology-table.html#cb208-4"></a>})</span></code></pre></div>
<p>We set up interface elements for changing the annotation parameters.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="gene-ontology-table.html#cb209-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;.defineDataInterface&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x, se, select_info) {</span>
<span id="cb209-2"><a href="gene-ontology-table.html#cb209-2"></a>    panel_name &lt;-<span class="st"> </span><span class="kw">.getEncodedName</span>(x)</span>
<span id="cb209-3"><a href="gene-ontology-table.html#cb209-3"></a>    <span class="kw">list</span>(</span>
<span id="cb209-4"><a href="gene-ontology-table.html#cb209-4"></a>        <span class="kw">selectInput</span>(<span class="kw">paste0</span>(panel_name, <span class="st">&quot;_IDType&quot;</span>),</span>
<span id="cb209-5"><a href="gene-ontology-table.html#cb209-5"></a>            <span class="dt">label=</span><span class="st">&quot;ID type:&quot;</span>,</span>
<span id="cb209-6"><a href="gene-ontology-table.html#cb209-6"></a>            <span class="dt">choices=</span>allowable,</span>
<span id="cb209-7"><a href="gene-ontology-table.html#cb209-7"></a>            <span class="dt">selected=</span>x[[<span class="st">&quot;IDType&quot;</span>]]</span>
<span id="cb209-8"><a href="gene-ontology-table.html#cb209-8"></a>        ),</span>
<span id="cb209-9"><a href="gene-ontology-table.html#cb209-9"></a>        <span class="kw">selectInput</span>(<span class="kw">paste0</span>(panel_name, <span class="st">&quot;_Organism&quot;</span>),</span>
<span id="cb209-10"><a href="gene-ontology-table.html#cb209-10"></a>            <span class="dt">label=</span><span class="st">&quot;Organism&quot;</span>,</span>
<span id="cb209-11"><a href="gene-ontology-table.html#cb209-11"></a>            <span class="dt">choices=</span><span class="kw">c</span>(<span class="st">&quot;org.Hs.eg.db&quot;</span>, <span class="st">&quot;org.Mm.eg.db&quot;</span>),</span>
<span id="cb209-12"><a href="gene-ontology-table.html#cb209-12"></a>            <span class="dt">selected=</span>x[[<span class="st">&quot;Organism&quot;</span>]]</span>
<span id="cb209-13"><a href="gene-ontology-table.html#cb209-13"></a>        )</span>
<span id="cb209-14"><a href="gene-ontology-table.html#cb209-14"></a>    )</span>
<span id="cb209-15"><a href="gene-ontology-table.html#cb209-15"></a>})</span></code></pre></div>
<p>Our implementation will be a pure transmitter, i.e., it will not respond to row or column selections from other panels.
To avoid confusion, we can hide all selection parameter UI elements by specializing the <code>.hideInterface()</code> method:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="gene-ontology-table.html#cb210-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;.hideInterface&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x, field) {</span>
<span id="cb210-2"><a href="gene-ontology-table.html#cb210-2"></a>    <span class="cf">if</span> (field <span class="op">%in%</span><span class="st"> &quot;SelectionBoxOpen&quot;</span>) {</span>
<span id="cb210-3"><a href="gene-ontology-table.html#cb210-3"></a>        <span class="ot">TRUE</span></span>
<span id="cb210-4"><a href="gene-ontology-table.html#cb210-4"></a>    } <span class="cf">else</span> {</span>
<span id="cb210-5"><a href="gene-ontology-table.html#cb210-5"></a>        <span class="kw">callNextMethod</span>()</span>
<span id="cb210-6"><a href="gene-ontology-table.html#cb210-6"></a>    }</span>
<span id="cb210-7"><a href="gene-ontology-table.html#cb210-7"></a>})</span></code></pre></div>
</div>
<div id="generating-the-output" class="section level2">
<h2><span class="header-section-number">8.4</span> Generating the output</h2>
<p>We actually generate the output by specializing the <code>.generateOutput()</code> function,
using the <em><a href="https://bioconductor.org/packages/3.11/GO.db">GO.db</a></em> package to create a table of GO terms and their definitions.
We also store the number of available genes in the <code>contents</code> -
this will be used later to compute the percentage of all genes in a given gene set.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="gene-ontology-table.html#cb211-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;.generateOutput&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x, se, ..., all_memory, all_contents) {</span>
<span id="cb211-2"><a href="gene-ontology-table.html#cb211-2"></a>    envir &lt;-<span class="st"> </span><span class="kw">new.env</span>()</span>
<span id="cb211-3"><a href="gene-ontology-table.html#cb211-3"></a>    commands &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;require(GO.db);&quot;</span>,</span>
<span id="cb211-4"><a href="gene-ontology-table.html#cb211-4"></a>        <span class="st">&quot;tab &lt;- select(GO.db, keys=keys(GO.db), columns=&#39;TERM&#39;);&quot;</span>,</span>
<span id="cb211-5"><a href="gene-ontology-table.html#cb211-5"></a>        <span class="st">&quot;rownames(tab) &lt;- tab$GOID;&quot;</span>,</span>
<span id="cb211-6"><a href="gene-ontology-table.html#cb211-6"></a>        <span class="st">&quot;tab$GOID &lt;- NULL;&quot;</span>)</span>
<span id="cb211-7"><a href="gene-ontology-table.html#cb211-7"></a>    <span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text=</span>commands), <span class="dt">envir=</span>envir)</span>
<span id="cb211-8"><a href="gene-ontology-table.html#cb211-8"></a>    <span class="kw">list</span>(</span>
<span id="cb211-9"><a href="gene-ontology-table.html#cb211-9"></a>        <span class="dt">commands=</span><span class="kw">list</span>(commands), </span>
<span id="cb211-10"><a href="gene-ontology-table.html#cb211-10"></a>        <span class="dt">contents=</span><span class="kw">list</span>(<span class="dt">table=</span>envir<span class="op">$</span>tab, <span class="dt">available=</span><span class="kw">nrow</span>(se)),</span>
<span id="cb211-11"><a href="gene-ontology-table.html#cb211-11"></a>        <span class="dt">varname=</span><span class="st">&quot;tab&quot;</span></span>
<span id="cb211-12"><a href="gene-ontology-table.html#cb211-12"></a>    )</span>
<span id="cb211-13"><a href="gene-ontology-table.html#cb211-13"></a>})</span></code></pre></div>
<p>We donâ€™t actually depend on any parameters of <code>x</code> itself to generate this table.
However, one could imagine a more complex case where the <code>GOTable</code> itself responds to a multiple row selection,
e.g., by subsetting to the gene sets that contain genes in the selected row.</p>
</div>
<div id="creating-the-observers" class="section level2">
<h2><span class="header-section-number">8.5</span> Creating the observers</h2>
<p>We specialize <code>.createObservers</code> to define some observers to respond to changes in our new interface elements.
This also involves creating an observer to respond to a change in the selection of a <code>DataTable</code> row,
calling <code>.requestActiveSelectionUpdate()</code> to trigger changes in panels that are receiving the multiple row selection.
(We set up observers for the search fields as well, as a courtesy to restore them properly upon re-rendering.)</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="gene-ontology-table.html#cb212-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;.createObservers&quot;</span>, <span class="st">&quot;GOTable&quot;</span>,</span>
<span id="cb212-2"><a href="gene-ontology-table.html#cb212-2"></a>    <span class="cf">function</span>(x, se, input, session, pObjects, rObjects)</span>
<span id="cb212-3"><a href="gene-ontology-table.html#cb212-3"></a>{</span>
<span id="cb212-4"><a href="gene-ontology-table.html#cb212-4"></a>    <span class="kw">callNextMethod</span>()</span>
<span id="cb212-5"><a href="gene-ontology-table.html#cb212-5"></a></span>
<span id="cb212-6"><a href="gene-ontology-table.html#cb212-6"></a>    panel_name &lt;-<span class="st"> </span><span class="kw">.getEncodedName</span>(x)</span>
<span id="cb212-7"><a href="gene-ontology-table.html#cb212-7"></a></span>
<span id="cb212-8"><a href="gene-ontology-table.html#cb212-8"></a>    <span class="kw">.createUnprotectedParameterObservers</span>(panel_name,</span>
<span id="cb212-9"><a href="gene-ontology-table.html#cb212-9"></a>        <span class="dt">fields=</span><span class="kw">c</span>(<span class="st">&quot;Organism&quot;</span>, <span class="st">&quot;IDType&quot;</span>), </span>
<span id="cb212-10"><a href="gene-ontology-table.html#cb212-10"></a>        <span class="dt">input=</span>input, <span class="dt">pObjects=</span>pObjects, <span class="dt">rObjects=</span>rObjects)</span>
<span id="cb212-11"><a href="gene-ontology-table.html#cb212-11"></a></span>
<span id="cb212-12"><a href="gene-ontology-table.html#cb212-12"></a>    <span class="co"># Observer for the DataTable row selection:</span></span>
<span id="cb212-13"><a href="gene-ontology-table.html#cb212-13"></a>    select_field &lt;-<span class="st"> </span><span class="kw">paste0</span>(panel_name, <span class="st">&quot;_rows_selected&quot;</span>)</span>
<span id="cb212-14"><a href="gene-ontology-table.html#cb212-14"></a>    multi_name &lt;-<span class="st"> </span><span class="kw">paste0</span>(panel_name, <span class="st">&quot;_&quot;</span>, iSEE<span class="op">:::</span>.flagMultiSelect)</span>
<span id="cb212-15"><a href="gene-ontology-table.html#cb212-15"></a>    <span class="kw">observeEvent</span>(input[[select_field]], {</span>
<span id="cb212-16"><a href="gene-ontology-table.html#cb212-16"></a>        chosen &lt;-<span class="st"> </span>input[[select_field]]</span>
<span id="cb212-17"><a href="gene-ontology-table.html#cb212-17"></a>        <span class="cf">if</span> (<span class="kw">length</span>(chosen)<span class="op">==</span>0L) {</span>
<span id="cb212-18"><a href="gene-ontology-table.html#cb212-18"></a>            chosen &lt;-<span class="st"> &quot;&quot;</span> </span>
<span id="cb212-19"><a href="gene-ontology-table.html#cb212-19"></a>        } <span class="cf">else</span> {</span>
<span id="cb212-20"><a href="gene-ontology-table.html#cb212-20"></a>            chosen &lt;-<span class="st"> </span><span class="kw">rownames</span>(pObjects<span class="op">$</span>contents[[panel_name]]<span class="op">$</span>table)[chosen]</span>
<span id="cb212-21"><a href="gene-ontology-table.html#cb212-21"></a>        }</span>
<span id="cb212-22"><a href="gene-ontology-table.html#cb212-22"></a></span>
<span id="cb212-23"><a href="gene-ontology-table.html#cb212-23"></a>        previous &lt;-<span class="st"> </span>pObjects<span class="op">$</span>memory[[panel_name]][[<span class="st">&quot;Selected&quot;</span>]]</span>
<span id="cb212-24"><a href="gene-ontology-table.html#cb212-24"></a>        <span class="cf">if</span> (chosen<span class="op">==</span>previous) {</span>
<span id="cb212-25"><a href="gene-ontology-table.html#cb212-25"></a>            <span class="kw">return</span>(<span class="ot">NULL</span>)</span>
<span id="cb212-26"><a href="gene-ontology-table.html#cb212-26"></a>        }</span>
<span id="cb212-27"><a href="gene-ontology-table.html#cb212-27"></a>        pObjects<span class="op">$</span>memory[[panel_name]][[<span class="st">&quot;Selected&quot;</span>]] &lt;-<span class="st"> </span>chosen</span>
<span id="cb212-28"><a href="gene-ontology-table.html#cb212-28"></a>        <span class="kw">.requestActiveSelectionUpdate</span>(panel_name, session, pObjects, rObjects, <span class="dt">update_output=</span><span class="ot">FALSE</span>)</span>
<span id="cb212-29"><a href="gene-ontology-table.html#cb212-29"></a>    }, <span class="dt">ignoreInit=</span><span class="ot">TRUE</span>, <span class="dt">ignoreNULL=</span><span class="ot">FALSE</span>)</span>
<span id="cb212-30"><a href="gene-ontology-table.html#cb212-30"></a></span>
<span id="cb212-31"><a href="gene-ontology-table.html#cb212-31"></a>    <span class="co"># Observer for the search field:</span></span>
<span id="cb212-32"><a href="gene-ontology-table.html#cb212-32"></a>    search_field &lt;-<span class="st"> </span><span class="kw">paste0</span>(panel_name, <span class="st">&quot;_search&quot;</span>)</span>
<span id="cb212-33"><a href="gene-ontology-table.html#cb212-33"></a>    <span class="kw">observeEvent</span>(input[[search_field]], {</span>
<span id="cb212-34"><a href="gene-ontology-table.html#cb212-34"></a>        search &lt;-<span class="st"> </span>input[[search_field]]</span>
<span id="cb212-35"><a href="gene-ontology-table.html#cb212-35"></a>        <span class="cf">if</span> (<span class="kw">identical</span>(search, pObjects<span class="op">$</span>memory[[panel_name]][[<span class="st">&quot;Search&quot;</span>]])) {</span>
<span id="cb212-36"><a href="gene-ontology-table.html#cb212-36"></a>            <span class="kw">return</span>(<span class="ot">NULL</span>)</span>
<span id="cb212-37"><a href="gene-ontology-table.html#cb212-37"></a>        }</span>
<span id="cb212-38"><a href="gene-ontology-table.html#cb212-38"></a>        pObjects<span class="op">$</span>memory[[panel_name]][[<span class="st">&quot;Search&quot;</span>]] &lt;-<span class="st"> </span>search</span>
<span id="cb212-39"><a href="gene-ontology-table.html#cb212-39"></a>    })</span>
<span id="cb212-40"><a href="gene-ontology-table.html#cb212-40"></a></span>
<span id="cb212-41"><a href="gene-ontology-table.html#cb212-41"></a>    <span class="co"># Observer for the column search fields:</span></span>
<span id="cb212-42"><a href="gene-ontology-table.html#cb212-42"></a>    colsearch_field &lt;-<span class="st"> </span><span class="kw">paste0</span>(panel_name, <span class="st">&quot;_search_columns&quot;</span>)</span>
<span id="cb212-43"><a href="gene-ontology-table.html#cb212-43"></a>    <span class="kw">observeEvent</span>(input[[colsearch_field]], {</span>
<span id="cb212-44"><a href="gene-ontology-table.html#cb212-44"></a>        search &lt;-<span class="st"> </span>input[[colsearch_field]]</span>
<span id="cb212-45"><a href="gene-ontology-table.html#cb212-45"></a>        <span class="cf">if</span> (<span class="kw">identical</span>(search, pObjects<span class="op">$</span>memory[[panel_name]][[<span class="st">&quot;SearchColumns&quot;</span>]])) {</span>
<span id="cb212-46"><a href="gene-ontology-table.html#cb212-46"></a>            <span class="kw">return</span>(<span class="ot">NULL</span>)</span>
<span id="cb212-47"><a href="gene-ontology-table.html#cb212-47"></a>        }</span>
<span id="cb212-48"><a href="gene-ontology-table.html#cb212-48"></a>        pObjects<span class="op">$</span>memory[[panel_name]][[<span class="st">&quot;SearchColumns&quot;</span>]] &lt;-<span class="st"> </span>search</span>
<span id="cb212-49"><a href="gene-ontology-table.html#cb212-49"></a>    })</span>
<span id="cb212-50"><a href="gene-ontology-table.html#cb212-50"></a>})</span></code></pre></div>
<p>Note the use of <code>callNextMethod()</code> to ensure that observers of the parent class are created.
We also set <code>ignoreInit=TRUE</code> to avoid problems from <code>ignoreNULL=TRUE</code> when the observer is initialized before the table is rendered; otherwise, the <code>NULL</code> selection prior to table rendering will wipe out any initial setting for the <code>Selected</code> slot.</p>
<p>We set up a rendering expression for the output table by specializing <code>.renderOutput()</code>.
This uses the <code>renderDataTable()</code> function from the <em><a href="https://CRAN.R-project.org/package=DT">DT</a></em> package
(again, this has a similar-but-not-identical function in <em><a href="https://CRAN.R-project.org/package=shiny">shiny</a></em>, so be careful which one you import.)
Some effort is involved in making sure that the output table responds to the memorized parameter values of our <code>GOTable</code> panel.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="gene-ontology-table.html#cb213-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;.renderOutput&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x, se, ..., output, pObjects, rObjects) {</span>
<span id="cb213-2"><a href="gene-ontology-table.html#cb213-2"></a>    <span class="kw">callNextMethod</span>()</span>
<span id="cb213-3"><a href="gene-ontology-table.html#cb213-3"></a></span>
<span id="cb213-4"><a href="gene-ontology-table.html#cb213-4"></a>    panel_name &lt;-<span class="st"> </span><span class="kw">.getEncodedName</span>(x)</span>
<span id="cb213-5"><a href="gene-ontology-table.html#cb213-5"></a>    output[[panel_name]] &lt;-<span class="st"> </span>DT<span class="op">::</span><span class="kw">renderDataTable</span>({</span>
<span id="cb213-6"><a href="gene-ontology-table.html#cb213-6"></a>        <span class="kw">.trackUpdate</span>(panel_name, rObjects)</span>
<span id="cb213-7"><a href="gene-ontology-table.html#cb213-7"></a>        param_choices &lt;-<span class="st"> </span>pObjects<span class="op">$</span>memory[[panel_name]]</span>
<span id="cb213-8"><a href="gene-ontology-table.html#cb213-8"></a></span>
<span id="cb213-9"><a href="gene-ontology-table.html#cb213-9"></a>        t.out &lt;-<span class="st"> </span><span class="kw">.retrieveOutput</span>(panel_name, se, pObjects, rObjects)</span>
<span id="cb213-10"><a href="gene-ontology-table.html#cb213-10"></a>        full_tab &lt;-<span class="st"> </span>t.out<span class="op">$</span>contents<span class="op">$</span>table</span>
<span id="cb213-11"><a href="gene-ontology-table.html#cb213-11"></a></span>
<span id="cb213-12"><a href="gene-ontology-table.html#cb213-12"></a>        chosen &lt;-<span class="st"> </span>param_choices[[<span class="st">&quot;Selected&quot;</span>]]</span>
<span id="cb213-13"><a href="gene-ontology-table.html#cb213-13"></a>        search &lt;-<span class="st"> </span>param_choices[[<span class="st">&quot;Search&quot;</span>]]</span>
<span id="cb213-14"><a href="gene-ontology-table.html#cb213-14"></a>        search_col &lt;-<span class="st"> </span>param_choices[[<span class="st">&quot;SearchColumns&quot;</span>]]</span>
<span id="cb213-15"><a href="gene-ontology-table.html#cb213-15"></a>        search_col &lt;-<span class="st"> </span><span class="kw">lapply</span>(search_col, <span class="dt">FUN=</span><span class="cf">function</span>(x) { <span class="kw">list</span>(<span class="dt">search=</span>x) })</span>
<span id="cb213-16"><a href="gene-ontology-table.html#cb213-16"></a></span>
<span id="cb213-17"><a href="gene-ontology-table.html#cb213-17"></a>        <span class="co"># If the existing row in memory doesn&#39;t exist in the current table, we</span></span>
<span id="cb213-18"><a href="gene-ontology-table.html#cb213-18"></a>        <span class="co"># don&#39;t initialize it with any selection.</span></span>
<span id="cb213-19"><a href="gene-ontology-table.html#cb213-19"></a>        idx &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">rownames</span>(full_tab)<span class="op">==</span>chosen)[<span class="dv">1</span>]</span>
<span id="cb213-20"><a href="gene-ontology-table.html#cb213-20"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.na</span>(idx)) {</span>
<span id="cb213-21"><a href="gene-ontology-table.html#cb213-21"></a>            selection &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">mode=</span><span class="st">&quot;single&quot;</span>, <span class="dt">selected=</span>idx)</span>
<span id="cb213-22"><a href="gene-ontology-table.html#cb213-22"></a>        } <span class="cf">else</span> {</span>
<span id="cb213-23"><a href="gene-ontology-table.html#cb213-23"></a>            selection &lt;-<span class="st"> &quot;single&quot;</span></span>
<span id="cb213-24"><a href="gene-ontology-table.html#cb213-24"></a>        }</span>
<span id="cb213-25"><a href="gene-ontology-table.html#cb213-25"></a></span>
<span id="cb213-26"><a href="gene-ontology-table.html#cb213-26"></a>        DT<span class="op">::</span><span class="kw">datatable</span>(</span>
<span id="cb213-27"><a href="gene-ontology-table.html#cb213-27"></a>            full_tab, <span class="dt">filter=</span><span class="st">&quot;top&quot;</span>, <span class="dt">rownames=</span><span class="ot">TRUE</span>,</span>
<span id="cb213-28"><a href="gene-ontology-table.html#cb213-28"></a>            <span class="dt">options=</span><span class="kw">list</span>(</span>
<span id="cb213-29"><a href="gene-ontology-table.html#cb213-29"></a>                <span class="dt">search=</span><span class="kw">list</span>(<span class="dt">search=</span>search, <span class="dt">smart=</span><span class="ot">FALSE</span>, <span class="dt">regex=</span><span class="ot">TRUE</span>, <span class="dt">caseInsensitive=</span><span class="ot">FALSE</span>),</span>
<span id="cb213-30"><a href="gene-ontology-table.html#cb213-30"></a>                <span class="dt">searchCols=</span><span class="kw">c</span>(<span class="kw">list</span>(<span class="ot">NULL</span>), search_col), <span class="co"># row names are the first column!</span></span>
<span id="cb213-31"><a href="gene-ontology-table.html#cb213-31"></a>                <span class="dt">scrollX=</span><span class="ot">TRUE</span>),</span>
<span id="cb213-32"><a href="gene-ontology-table.html#cb213-32"></a>            <span class="dt">selection=</span>selection</span>
<span id="cb213-33"><a href="gene-ontology-table.html#cb213-33"></a>        )</span>
<span id="cb213-34"><a href="gene-ontology-table.html#cb213-34"></a>    })</span>
<span id="cb213-35"><a href="gene-ontology-table.html#cb213-35"></a>})</span></code></pre></div>
</div>
<div id="handling-selections" class="section level2">
<h2><span class="header-section-number">8.6</span> Handling selections</h2>
<p>Now for the most important bit - configuring the <code>GOTable</code> to transmit a multiple row selection to other panels.
This is achieved by specializing a series of <code>.multiSelection*()</code> methods.
The first is the <code>.multiSelectionDimension()</code>, which controls the dimension being transmitted:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="gene-ontology-table.html#cb214-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;.multiSelectionDimension&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x) <span class="st">&quot;row&quot;</span>)</span></code></pre></div>
<p>The next most important method is the <code>.multiSelectionCommands()</code>, which tells <code>iSEE()</code> how to create the multiple row selection from the selected <code>DataTable</code> row.
It is expected to return a vector of commands that, when evaluated, creates a character vector of row names for transmission.
This has an option (<code>index</code>) to differentiate between active and saved selections, though the latter case is not relevant to our <code>GOTable</code> so we will simply ignore it.
We also need to protect against cases where the requested GO term is not found, upon which we simply return an empty character vector.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="gene-ontology-table.html#cb215-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;.multiSelectionCommands&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x, index) {</span>
<span id="cb215-2"><a href="gene-ontology-table.html#cb215-2"></a>    orgdb &lt;-<span class="st"> </span>x[[<span class="st">&quot;Organism&quot;</span>]]</span>
<span id="cb215-3"><a href="gene-ontology-table.html#cb215-3"></a>    type &lt;-<span class="st"> </span>x[[<span class="st">&quot;IDType&quot;</span>]]</span>
<span id="cb215-4"><a href="gene-ontology-table.html#cb215-4"></a>    <span class="kw">c</span>(</span>
<span id="cb215-5"><a href="gene-ontology-table.html#cb215-5"></a>        <span class="kw">sprintf</span>(<span class="st">&quot;require(%s);&quot;</span>, orgdb),</span>
<span id="cb215-6"><a href="gene-ontology-table.html#cb215-6"></a>        <span class="kw">sprintf</span>(<span class="st">&quot;selected &lt;- tryCatch(select(%s, keys=%s, keytype=&#39;GO&#39;, </span></span>
<span id="cb215-7"><a href="gene-ontology-table.html#cb215-7"></a><span class="st">    column=%s)$SYMBOL, error=function(e) character(0));&quot;</span>, </span>
<span id="cb215-8"><a href="gene-ontology-table.html#cb215-8"></a>            orgdb, <span class="kw">deparse</span>(x[[<span class="st">&quot;Selected&quot;</span>]]), <span class="kw">deparse</span>(type)),</span>
<span id="cb215-9"><a href="gene-ontology-table.html#cb215-9"></a>        <span class="st">&quot;selected &lt;- intersect(selected, rownames(se));&quot;</span></span>
<span id="cb215-10"><a href="gene-ontology-table.html#cb215-10"></a>    )</span>
<span id="cb215-11"><a href="gene-ontology-table.html#cb215-11"></a>})</span></code></pre></div>
<p>We also define some generics to indicate whether a <code>DataTable</code> row is currently selected, and how to delete that selection.
For the latter, we replace the selected row with an empty string to indicate that no selection has been made,
consistent with the actions of our observer in <code>.createObservers()</code>.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="gene-ontology-table.html#cb216-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;.multiSelectionActive&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x) {</span>
<span id="cb216-2"><a href="gene-ontology-table.html#cb216-2"></a>    <span class="cf">if</span> (x[[<span class="st">&quot;Selected&quot;</span>]]<span class="op">!=</span><span class="st">&quot;&quot;</span>) {</span>
<span id="cb216-3"><a href="gene-ontology-table.html#cb216-3"></a>        x[[<span class="st">&quot;Selected&quot;</span>]]</span>
<span id="cb216-4"><a href="gene-ontology-table.html#cb216-4"></a>    } <span class="cf">else</span> {</span>
<span id="cb216-5"><a href="gene-ontology-table.html#cb216-5"></a>        <span class="ot">NULL</span></span>
<span id="cb216-6"><a href="gene-ontology-table.html#cb216-6"></a>    }</span>
<span id="cb216-7"><a href="gene-ontology-table.html#cb216-7"></a>})</span>
<span id="cb216-8"><a href="gene-ontology-table.html#cb216-8"></a></span>
<span id="cb216-9"><a href="gene-ontology-table.html#cb216-9"></a><span class="kw">setMethod</span>(<span class="st">&quot;.multiSelectionClear&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x) {</span>
<span id="cb216-10"><a href="gene-ontology-table.html#cb216-10"></a>    x[[<span class="st">&quot;Selected&quot;</span>]] &lt;-<span class="st"> &quot;&quot;</span></span>
<span id="cb216-11"><a href="gene-ontology-table.html#cb216-11"></a>    x</span>
<span id="cb216-12"><a href="gene-ontology-table.html#cb216-12"></a>})</span></code></pre></div>
<p>Finally, we define a method to determine the total number of available genes.
The default is to use the number of rows of the <code>data.frame</code> used in the <code>datatable()</code> call,
but that would not be right for us as it represents the number of gene sets.
Instead, we use the availability information that we previously stored in the <code>contents</code> during <code>.generateOutput()</code>.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="gene-ontology-table.html#cb217-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;.multiSelectionAvailable&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x, contents) {</span>
<span id="cb217-2"><a href="gene-ontology-table.html#cb217-2"></a>    contents<span class="op">$</span>available</span>
<span id="cb217-3"><a href="gene-ontology-table.html#cb217-3"></a>})</span></code></pre></div>
</div>
<div id="in-action" class="section level2">
<h2><span class="header-section-number">8.7</span> In action</h2>
<p>Letâ€™s put our new panel to the test using the <code>sce</code> object from Chapter <a href="developing.html#developing">4</a>.
We set up an <code>iSEE</code> instance where clicking on any row in the <code>GOTable</code> will subset <code>RowTable1</code> to only those genes in the corresponding GO term.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="gene-ontology-table.html#cb218-1"></a>got &lt;-<span class="st"> </span><span class="kw">GOTable</span>(<span class="dt">PanelWidth=</span>8L, <span class="dt">Selected=</span><span class="st">&quot;GO:0007049&quot;</span>, <span class="dt">Search=</span><span class="st">&quot;^cell cycle&quot;</span>)</span>
<span id="cb218-2"><a href="gene-ontology-table.html#cb218-2"></a>rst &lt;-<span class="st"> </span><span class="kw">RowDataTable</span>(<span class="dt">RowSelectionSource=</span><span class="st">&quot;GOTable1&quot;</span>)</span>
<span id="cb218-3"><a href="gene-ontology-table.html#cb218-3"></a>app &lt;-<span class="st"> </span><span class="kw">iSEE</span>(sce, <span class="dt">initial=</span><span class="kw">list</span>(got, rst))</span></code></pre></div>
<p><img src="screenshots/go-table.png" width="100%" /></p>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="annotated-gene-list.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="contributors.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["iSEE-book.pdf", "iSEE-book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
