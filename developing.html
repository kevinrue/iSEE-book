<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Reduced dimension hexbin plot | Extending iSEE</title>
  <meta name="description" content="This book describes how to use the Bioconductor iSEE package to create web-applications for exploring data stored in SummarizedExperiment objects." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Reduced dimension hexbin plot | Extending iSEE" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book describes how to use the Bioconductor iSEE package to create web-applications for exploring data stored in SummarizedExperiment objects." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Reduced dimension hexbin plot | Extending iSEE" />
  
  <meta name="twitter:description" content="This book describes how to use the Bioconductor iSEE package to create web-applications for exploring data stored in SummarizedExperiment objects." />
  

<meta name="author" content="Kevin Rue-Albrecht, Federico Marini, Charlotte Soneson, and Aaron Lun" />


<meta name="date" content="2020-07-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="server.html"/>
<link rel="next" href="dynamic-reduced-dimensions.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Extending <i>iSEE</i></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="part"><span><b>I API overview</b></span></li>
<li class="chapter" data-level="1" data-path="panels.html"><a href="panels.html"><i class="fa fa-check"></i><b>1</b> Panel classes</a><ul>
<li class="chapter" data-level="1.1" data-path="panels.html"><a href="panels.html#overview"><i class="fa fa-check"></i><b>1.1</b> Overview</a></li>
<li class="chapter" data-level="1.2" data-path="panels.html"><a href="panels.html#virtual-classes"><i class="fa fa-check"></i><b>1.2</b> Virtual classes</a><ul>
<li class="chapter" data-level="1.2.1" data-path="panels.html"><a href="panels.html#panel"><i class="fa fa-check"></i><b>1.2.1</b> <code>Panel</code></a></li>
<li class="chapter" data-level="1.2.2" data-path="panels.html"><a href="panels.html#dotplot"><i class="fa fa-check"></i><b>1.2.2</b> <code>DotPlot</code></a></li>
<li class="chapter" data-level="1.2.3" data-path="panels.html"><a href="panels.html#columndotplot"><i class="fa fa-check"></i><b>1.2.3</b> <code>ColumnDotPlot</code></a></li>
<li class="chapter" data-level="1.2.4" data-path="panels.html"><a href="panels.html#rowdotplot"><i class="fa fa-check"></i><b>1.2.4</b> <code>RowDotPlot</code></a></li>
<li class="chapter" data-level="1.2.5" data-path="panels.html"><a href="panels.html#table"><i class="fa fa-check"></i><b>1.2.5</b> <code>Table</code></a></li>
<li class="chapter" data-level="1.2.6" data-path="panels.html"><a href="panels.html#columntable"><i class="fa fa-check"></i><b>1.2.6</b> <code>ColumnTable</code></a></li>
<li class="chapter" data-level="1.2.7" data-path="panels.html"><a href="panels.html#rowtable"><i class="fa fa-check"></i><b>1.2.7</b> <code>RowTable</code></a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="panels.html"><a href="panels.html#concrete-classes"><i class="fa fa-check"></i><b>1.3</b> Concrete classes</a><ul>
<li class="chapter" data-level="1.3.1" data-path="panels.html"><a href="panels.html#reduceddimensionplot"><i class="fa fa-check"></i><b>1.3.1</b> <code>ReducedDimensionPlot</code></a></li>
<li class="chapter" data-level="1.3.2" data-path="panels.html"><a href="panels.html#featureassayplot"><i class="fa fa-check"></i><b>1.3.2</b> <code>FeatureAssayPlot</code></a></li>
<li class="chapter" data-level="1.3.3" data-path="panels.html"><a href="panels.html#columndataplot"><i class="fa fa-check"></i><b>1.3.3</b> <code>ColumnDataPlot</code></a></li>
<li class="chapter" data-level="1.3.4" data-path="panels.html"><a href="panels.html#sampleassayplot"><i class="fa fa-check"></i><b>1.3.4</b> <code>SampleAssayPlot</code></a></li>
<li class="chapter" data-level="1.3.5" data-path="panels.html"><a href="panels.html#rowdataplot"><i class="fa fa-check"></i><b>1.3.5</b> <code>RowDataPlot</code></a></li>
<li class="chapter" data-level="1.3.6" data-path="panels.html"><a href="panels.html#columndatatable"><i class="fa fa-check"></i><b>1.3.6</b> <code>ColumnDataTable</code></a></li>
<li class="chapter" data-level="1.3.7" data-path="panels.html"><a href="panels.html#rowdatatable"><i class="fa fa-check"></i><b>1.3.7</b> <code>RowDataTable</code></a></li>
<li class="chapter" data-level="1.3.8" data-path="panels.html"><a href="panels.html#complexheatmapplot"><i class="fa fa-check"></i><b>1.3.8</b> <code>ComplexHeatmapPlot</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="api.html"><a href="api.html"><i class="fa fa-check"></i><b>2</b> Panel generics</a><ul>
<li class="chapter" data-level="2.1" data-path="panels.html"><a href="panels.html#overview"><i class="fa fa-check"></i><b>2.1</b> Overview</a></li>
<li class="chapter" data-level="2.2" data-path="api.html"><a href="api.html#parameter-set-up"><i class="fa fa-check"></i><b>2.2</b> Parameter set-up</a></li>
<li class="chapter" data-level="2.3" data-path="api.html"><a href="api.html#defining-the-user-interface"><i class="fa fa-check"></i><b>2.3</b> Defining the user interface</a><ul>
<li class="chapter" data-level="2.3.1" data-path="api.html"><a href="api.html#in-general"><i class="fa fa-check"></i><b>2.3.1</b> In general</a></li>
<li class="chapter" data-level="2.3.2" data-path="api.html"><a href="api.html#the-dotplot-visual-interface"><i class="fa fa-check"></i><b>2.3.2</b> The <code>DotPlot</code> visual interface</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="api.html"><a href="api.html#creating-observers"><i class="fa fa-check"></i><b>2.4</b> Creating observers</a></li>
<li class="chapter" data-level="2.5" data-path="api.html"><a href="api.html#defining-panel-outputs"><i class="fa fa-check"></i><b>2.5</b> Defining panel outputs</a><ul>
<li class="chapter" data-level="2.5.1" data-path="api.html"><a href="api.html#in-general-1"><i class="fa fa-check"></i><b>2.5.1</b> In general</a></li>
<li class="chapter" data-level="2.5.2" data-path="api.html"><a href="api.html#for-dotplots"><i class="fa fa-check"></i><b>2.5.2</b> For <code>DotPlot</code>s</a></li>
<li class="chapter" data-level="2.5.3" data-path="api.html"><a href="api.html#for-metadata-dotplots"><i class="fa fa-check"></i><b>2.5.3</b> For metadata <code>DotPlot</code>s</a></li>
<li class="chapter" data-level="2.5.4" data-path="api.html"><a href="api.html#for-tables"><i class="fa fa-check"></i><b>2.5.4</b> For <code>Table</code>s</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="api.html"><a href="api.html#handling-selections"><i class="fa fa-check"></i><b>2.6</b> Handling selections</a><ul>
<li class="chapter" data-level="2.6.1" data-path="api.html"><a href="api.html#multiple"><i class="fa fa-check"></i><b>2.6.1</b> Multiple</a></li>
<li class="chapter" data-level="2.6.2" data-path="api.html"><a href="api.html#single"><i class="fa fa-check"></i><b>2.6.2</b> Single</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="server.html"><a href="server.html"><i class="fa fa-check"></i><b>3</b> Application state</a><ul>
<li class="chapter" data-level="3.1" data-path="panels.html"><a href="panels.html#overview"><i class="fa fa-check"></i><b>3.1</b> Overview</a></li>
<li class="chapter" data-level="3.2" data-path="server.html"><a href="server.html#updating-parameters"><i class="fa fa-check"></i><b>3.2</b> Updating parameters</a></li>
<li class="chapter" data-level="3.3" data-path="server.html"><a href="server.html#using-the-memory"><i class="fa fa-check"></i><b>3.3</b> Using the memory</a></li>
<li class="chapter" data-level="3.4" data-path="server.html"><a href="server.html#responding-to-events"><i class="fa fa-check"></i><b>3.4</b> Responding to events</a></li>
</ul></li>
<li class="part"><span><b>II Worked examples</b></span></li>
<li class="chapter" data-level="4" data-path="developing.html"><a href="developing.html"><i class="fa fa-check"></i><b>4</b> Reduced dimension hexbin plot</a><ul>
<li class="chapter" data-level="4.1" data-path="panels.html"><a href="panels.html#overview"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="developing.html"><a href="developing.html#class-basics"><i class="fa fa-check"></i><b>4.2</b> Class basics</a></li>
<li class="chapter" data-level="4.3" data-path="developing.html"><a href="developing.html#setting-up-the-interface"><i class="fa fa-check"></i><b>4.3</b> Setting up the interface</a></li>
<li class="chapter" data-level="4.4" data-path="developing.html"><a href="developing.html#creating-the-observers"><i class="fa fa-check"></i><b>4.4</b> Creating the observers</a></li>
<li class="chapter" data-level="4.5" data-path="developing.html"><a href="developing.html#generating-the-plot"><i class="fa fa-check"></i><b>4.5</b> Generating the plot</a></li>
<li class="chapter" data-level="4.6" data-path="developing.html"><a href="developing.html#in-action"><i class="fa fa-check"></i><b>4.6</b> In action</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dynamic-reduced-dimensions.html"><a href="dynamic-reduced-dimensions.html"><i class="fa fa-check"></i><b>5</b> Dynamic reduced dimensions</a><ul>
<li class="chapter" data-level="5.1" data-path="panels.html"><a href="panels.html#overview"><i class="fa fa-check"></i><b>5.1</b> Overview</a></li>
<li class="chapter" data-level="5.2" data-path="developing.html"><a href="developing.html#class-basics"><i class="fa fa-check"></i><b>5.2</b> Class basics</a></li>
<li class="chapter" data-level="5.3" data-path="developing.html"><a href="developing.html#setting-up-the-interface"><i class="fa fa-check"></i><b>5.3</b> Setting up the interface</a></li>
<li class="chapter" data-level="5.4" data-path="developing.html"><a href="developing.html#creating-the-observers"><i class="fa fa-check"></i><b>5.4</b> Creating the observers</a></li>
<li class="chapter" data-level="5.5" data-path="dynamic-reduced-dimensions.html"><a href="dynamic-reduced-dimensions.html#making-the-plot"><i class="fa fa-check"></i><b>5.5</b> Making the plot</a></li>
<li class="chapter" data-level="5.6" data-path="developing.html"><a href="developing.html#in-action"><i class="fa fa-check"></i><b>5.6</b> In action</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="dynamic-differential-expression.html"><a href="dynamic-differential-expression.html"><i class="fa fa-check"></i><b>6</b> Dynamic differential expression</a><ul>
<li class="chapter" data-level="6.1" data-path="panels.html"><a href="panels.html#overview"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="developing.html"><a href="developing.html#class-basics"><i class="fa fa-check"></i><b>6.2</b> Class basics</a></li>
<li class="chapter" data-level="6.3" data-path="developing.html"><a href="developing.html#setting-up-the-interface"><i class="fa fa-check"></i><b>6.3</b> Setting up the interface</a></li>
<li class="chapter" data-level="6.4" data-path="developing.html"><a href="developing.html#creating-the-observers"><i class="fa fa-check"></i><b>6.4</b> Creating the observers</a></li>
<li class="chapter" data-level="6.5" data-path="dynamic-differential-expression.html"><a href="dynamic-differential-expression.html#making-the-table"><i class="fa fa-check"></i><b>6.5</b> Making the table</a></li>
<li class="chapter" data-level="6.6" data-path="developing.html"><a href="developing.html#in-action"><i class="fa fa-check"></i><b>6.6</b> In action</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="annotated-gene-list.html"><a href="annotated-gene-list.html"><i class="fa fa-check"></i><b>7</b> Annotated gene list</a><ul>
<li class="chapter" data-level="7.1" data-path="panels.html"><a href="panels.html#overview"><i class="fa fa-check"></i><b>7.1</b> Overview</a></li>
<li class="chapter" data-level="7.2" data-path="developing.html"><a href="developing.html#class-basics"><i class="fa fa-check"></i><b>7.2</b> Class basics</a></li>
<li class="chapter" data-level="7.3" data-path="developing.html"><a href="developing.html#setting-up-the-interface"><i class="fa fa-check"></i><b>7.3</b> Setting up the interface</a></li>
<li class="chapter" data-level="7.4" data-path="developing.html"><a href="developing.html#creating-the-observers"><i class="fa fa-check"></i><b>7.4</b> Creating the observers</a></li>
<li class="chapter" data-level="7.5" data-path="developing.html"><a href="developing.html#in-action"><i class="fa fa-check"></i><b>7.5</b> In action</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="gene-ontology-table.html"><a href="gene-ontology-table.html"><i class="fa fa-check"></i><b>8</b> Gene ontology table</a><ul>
<li class="chapter" data-level="8.1" data-path="panels.html"><a href="panels.html#overview"><i class="fa fa-check"></i><b>8.1</b> Overview</a></li>
<li class="chapter" data-level="8.2" data-path="developing.html"><a href="developing.html#class-basics"><i class="fa fa-check"></i><b>8.2</b> Class basics</a></li>
<li class="chapter" data-level="8.3" data-path="developing.html"><a href="developing.html#setting-up-the-interface"><i class="fa fa-check"></i><b>8.3</b> Setting up the interface</a></li>
<li class="chapter" data-level="8.4" data-path="gene-ontology-table.html"><a href="gene-ontology-table.html#generating-the-output"><i class="fa fa-check"></i><b>8.4</b> Generating the output</a></li>
<li class="chapter" data-level="8.5" data-path="developing.html"><a href="developing.html#creating-the-observers"><i class="fa fa-check"></i><b>8.5</b> Creating the observers</a></li>
<li class="chapter" data-level="8.6" data-path="api.html"><a href="api.html#handling-selections"><i class="fa fa-check"></i><b>8.6</b> Handling selections</a></li>
<li class="chapter" data-level="8.7" data-path="developing.html"><a href="developing.html#in-action"><i class="fa fa-check"></i><b>8.7</b> In action</a></li>
</ul></li>
<li class="part"><span><b>III Appendix</b></span></li>
<li class="chapter" data-level="9" data-path="contributors.html"><a href="contributors.html"><i class="fa fa-check"></i><b>9</b> Contributors</a><ul>
<li><a href="contributors.html#aaron-lun"><em>Aaron Lun</em></a></li>
<li><a href="contributors.html#kevin-rue-albrecht"><em>Kevin Rue-Albrecht</em></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Extending <em>iSEE</em></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="developing" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Reduced dimension hexbin plot</h1>
<div id="overview" class="section level2">
<h2><span class="header-section-number">4.1</span> Overview</h2>
<p>In this example, we will create a panel class to show dimensionality reduction results using a hexbin plot.
The idea is to improve plotting speed for large datasets by binning points rather than showing each point individually.
Astute readers will note that the proposed class is the same as the <code>ReducedDimensionHexPlot</code> from <em><a href="https://bioconductor.org/packages/3.11/iSEEu">iSEEu</a></em>.
This chapter will describe the most relevant aspects of the development process to create a reasonably functional class.</p>
</div>
<div id="class-basics" class="section level2">
<h2><span class="header-section-number">4.2</span> Class basics</h2>
<p>The choice of a parent class depends on the properties that we want that new panel class to start with.
In this case, to create a panel that inherits all the functionality of the <code>ReducedDimensionPlot</code> panel type, we simply define a new class that extends that class.
We will call the new class <code>RedDimHexPlot</code>, adding an extra parameter to control the resolution of the hexbins.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="developing.html#cb168-1"></a><span class="kw">setClass</span>(<span class="st">&quot;RedDimHexPlot&quot;</span>, <span class="dt">contains=</span><span class="st">&quot;ReducedDimensionPlot&quot;</span>, </span>
<span id="cb168-2"><a href="developing.html#cb168-2"></a>    <span class="dt">slots=</span><span class="kw">c</span>(<span class="dt">BinResolution=</span><span class="st">&quot;numeric&quot;</span>))</span></code></pre></div>
<p>Any new slots should come with validity methods, as shown below.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="developing.html#cb169-1"></a><span class="kw">library</span>(S4Vectors)</span>
<span id="cb169-2"><a href="developing.html#cb169-2"></a><span class="kw">setValidity2</span>(<span class="st">&quot;RedDimHexPlot&quot;</span>, <span class="cf">function</span>(object) {</span>
<span id="cb169-3"><a href="developing.html#cb169-3"></a>    msg &lt;-<span class="st"> </span><span class="kw">character</span>(<span class="dv">0</span>)</span>
<span id="cb169-4"><a href="developing.html#cb169-4"></a></span>
<span id="cb169-5"><a href="developing.html#cb169-5"></a>    <span class="cf">if</span> (<span class="kw">length</span>(val &lt;-<span class="st"> </span>object[[<span class="st">&quot;BinResolution&quot;</span>]])<span class="op">!=</span>1L <span class="op">||</span><span class="st"> </span>val <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>) {</span>
<span id="cb169-6"><a href="developing.html#cb169-6"></a>        msg &lt;-<span class="st"> </span><span class="kw">c</span>(msg, <span class="st">&quot;&#39;BinResolution&#39; must be a positive number&quot;</span>)</span>
<span id="cb169-7"><a href="developing.html#cb169-7"></a>    }</span>
<span id="cb169-8"><a href="developing.html#cb169-8"></a>    <span class="cf">if</span> (<span class="kw">length</span>(msg)) {</span>
<span id="cb169-9"><a href="developing.html#cb169-9"></a>        <span class="kw">return</span>(msg)</span>
<span id="cb169-10"><a href="developing.html#cb169-10"></a>    }</span>
<span id="cb169-11"><a href="developing.html#cb169-11"></a>    <span class="ot">TRUE</span></span>
<span id="cb169-12"><a href="developing.html#cb169-12"></a>})</span></code></pre></div>
<p>We specialize the <code>initialize()</code> method to provide a default for the new parameter.
We also define a constructor function to make it easier to create a new instance.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="developing.html#cb170-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;initialize&quot;</span>, <span class="st">&quot;RedDimHexPlot&quot;</span>,</span>
<span id="cb170-2"><a href="developing.html#cb170-2"></a>    <span class="cf">function</span>(.Object, <span class="dt">BinResolution=</span><span class="dv">100</span>, ...)</span>
<span id="cb170-3"><a href="developing.html#cb170-3"></a>{</span>
<span id="cb170-4"><a href="developing.html#cb170-4"></a>    <span class="kw">callNextMethod</span>(.Object, <span class="dt">BinResolution=</span>BinResolution, ...)</span>
<span id="cb170-5"><a href="developing.html#cb170-5"></a>})</span>
<span id="cb170-6"><a href="developing.html#cb170-6"></a></span>
<span id="cb170-7"><a href="developing.html#cb170-7"></a>RedDimHexPlot &lt;-<span class="st"> </span><span class="cf">function</span>(...) {</span>
<span id="cb170-8"><a href="developing.html#cb170-8"></a>    <span class="kw">new</span>(<span class="st">&quot;RedDimHexPlot&quot;</span>, ...)</span>
<span id="cb170-9"><a href="developing.html#cb170-9"></a>}</span></code></pre></div>
<p>At this point, we can already create and use instances of this new panel class in <em><a href="https://bioconductor.org/packages/3.11/iSEE">iSEE</a></em> apps.
However, that would not be very exciting as instances of this new panel class would behave exactly like the those of the parent <code>ReducedDimensionPlot</code> class.
Let’s define a few more methods to introduce some more relevant differences in behavior.</p>
</div>
<div id="setting-up-the-interface" class="section level2">
<h2><span class="header-section-number">4.3</span> Setting up the interface</h2>
<p>Currently, instances of our new class are indistinguishable from the parent <code>ReducedDimensionPlot</code> in the <code>iSEE</code> interface.
To differentiate our new class, we create a method for the <code>.fullName()</code> generic to show a different name.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="developing.html#cb171-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;.fullName&quot;</span>, <span class="st">&quot;RedDimHexPlot&quot;</span>, <span class="cf">function</span>(x) <span class="st">&quot;Reduced dimension hexagonal plot&quot;</span>)</span></code></pre></div>
<p>While we’re here, we might as well give the panel a different color as well.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="developing.html#cb172-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;.panelColor&quot;</span>, <span class="st">&quot;RedDimHexPlot&quot;</span>, <span class="cf">function</span>(x) <span class="st">&quot;#AA5500&quot;</span>)</span></code></pre></div>
<p>We also override aspects of the user interface to add a parameter to modify the bin resolution.
Here, we place a <code>numericInput</code> widget into the set of parameters controlling the size aesthetics.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="developing.html#cb173-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;.defineVisualSizeInterface&quot;</span>, <span class="st">&quot;RedDimHexPlot&quot;</span>, <span class="cf">function</span>(x) {</span>
<span id="cb173-2"><a href="developing.html#cb173-2"></a>    plot_name &lt;-<span class="st"> </span><span class="kw">.getEncodedName</span>(x)</span>
<span id="cb173-3"><a href="developing.html#cb173-3"></a>    <span class="kw">tagList</span>(</span>
<span id="cb173-4"><a href="developing.html#cb173-4"></a>        <span class="kw">numericInput</span>(</span>
<span id="cb173-5"><a href="developing.html#cb173-5"></a>            <span class="kw">paste0</span>(plot_name, <span class="st">&quot;_&quot;</span>, <span class="st">&quot;BinResolution&quot;</span>), <span class="dt">label=</span><span class="st">&quot;Bin resolution:&quot;</span>,</span>
<span id="cb173-6"><a href="developing.html#cb173-6"></a>            <span class="dt">min=</span><span class="dv">1</span>, <span class="dt">value=</span>x[[<span class="st">&quot;BinResolution&quot;</span>]], <span class="dt">step =</span> <span class="dv">1</span>)</span>
<span id="cb173-7"><a href="developing.html#cb173-7"></a>    )</span>
<span id="cb173-8"><a href="developing.html#cb173-8"></a>})</span></code></pre></div>
<p>Conversely, some other aspects of the UI are now irrelevant because we are no longer showing individual points.
This includes the shape of the points, point-related downsampling and a variety of other aesthetic features.
Thus, we hide or disable them to avoid cluttering the interface.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="developing.html#cb174-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;.hideInterface&quot;</span>, <span class="st">&quot;RedDimHexPlot&quot;</span>, <span class="cf">function</span>(x, field) {</span>
<span id="cb174-2"><a href="developing.html#cb174-2"></a>    <span class="cf">if</span> (field <span class="op">==</span><span class="st"> &quot;Downsample&quot;</span>) <span class="ot">TRUE</span> <span class="cf">else</span> <span class="kw">callNextMethod</span>()</span>
<span id="cb174-3"><a href="developing.html#cb174-3"></a>})</span>
<span id="cb174-4"><a href="developing.html#cb174-4"></a></span>
<span id="cb174-5"><a href="developing.html#cb174-5"></a><span class="kw">setMethod</span>(<span class="st">&quot;.defineVisualShapeInterface&quot;</span>, <span class="st">&quot;RedDimHexPlot&quot;</span>, <span class="cf">function</span>(x) {</span>
<span id="cb174-6"><a href="developing.html#cb174-6"></a>    <span class="ot">NULL</span></span>
<span id="cb174-7"><a href="developing.html#cb174-7"></a>})</span>
<span id="cb174-8"><a href="developing.html#cb174-8"></a></span>
<span id="cb174-9"><a href="developing.html#cb174-9"></a><span class="kw">setMethod</span>(<span class="st">&quot;.defineVisualOtherInterface&quot;</span>, <span class="st">&quot;RedDimHexPlot&quot;</span>, <span class="cf">function</span>(x) {</span>
<span id="cb174-10"><a href="developing.html#cb174-10"></a>    <span class="ot">NULL</span></span>
<span id="cb174-11"><a href="developing.html#cb174-11"></a>})</span></code></pre></div>
</div>
<div id="creating-the-observers" class="section level2">
<h2><span class="header-section-number">4.4</span> Creating the observers</h2>
<p>The only new UI element we added was the widget to control the bin resolution.
Thus, the only new observer that needs to be added is the one that respects to this element.
Note the use of <code>callNextMethod()</code> to ensure that the observers for the parent class are also instantiated.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="developing.html#cb175-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;.createObservers&quot;</span>, <span class="st">&quot;RedDimHexPlot&quot;</span>, <span class="cf">function</span>(x, se, input, session, pObjects, rObjects) {</span>
<span id="cb175-2"><a href="developing.html#cb175-2"></a>    <span class="kw">callNextMethod</span>()</span>
<span id="cb175-3"><a href="developing.html#cb175-3"></a></span>
<span id="cb175-4"><a href="developing.html#cb175-4"></a>    plot_name &lt;-<span class="st"> </span><span class="kw">.getEncodedName</span>(x)</span>
<span id="cb175-5"><a href="developing.html#cb175-5"></a></span>
<span id="cb175-6"><a href="developing.html#cb175-6"></a>    <span class="kw">.createProtectedParameterObservers</span>(plot_name,</span>
<span id="cb175-7"><a href="developing.html#cb175-7"></a>        <span class="dt">fields=</span><span class="kw">c</span>(<span class="st">&quot;BinResolution&quot;</span>),</span>
<span id="cb175-8"><a href="developing.html#cb175-8"></a>        <span class="dt">input=</span>input, <span class="dt">pObjects=</span>pObjects, <span class="dt">rObjects=</span>rObjects)</span>
<span id="cb175-9"><a href="developing.html#cb175-9"></a></span>
<span id="cb175-10"><a href="developing.html#cb175-10"></a>    <span class="kw">invisible</span>(<span class="ot">NULL</span>)</span>
<span id="cb175-11"><a href="developing.html#cb175-11"></a>})</span></code></pre></div>
</div>
<div id="generating-the-plot" class="section level2">
<h2><span class="header-section-number">4.5</span> Generating the plot</h2>
<p>We create a method for the <code>.generateDotPlot()</code> generic to implement our hexbinning strategy.
The contract for this generic guarantees that our method can immediately rely on the <code>plot.data</code> data-frame that is computed by methods defined for the parent <code>ReducedDimensionPlot</code> class.
We also use the precomputed aesthetic <code>labels</code> associated with each column of <code>plot.data</code>, while setting a fixed label <code>"Count"</code> for the <code>fill</code> aesthetic associated with the count of observation in each hexagonal bin.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="developing.html#cb176-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb176-2"><a href="developing.html#cb176-2"></a><span class="kw">setMethod</span>(<span class="st">&quot;.generateDotPlot&quot;</span>, <span class="st">&quot;RedDimHexPlot&quot;</span>, <span class="cf">function</span>(x, labels, envir) {</span>
<span id="cb176-3"><a href="developing.html#cb176-3"></a>    plot_cmds &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb176-4"><a href="developing.html#cb176-4"></a>    plot_cmds[[<span class="st">&quot;ggplot&quot;</span>]] &lt;-<span class="st"> &quot;dot.plot &lt;- ggplot() +&quot;</span></span>
<span id="cb176-5"><a href="developing.html#cb176-5"></a>    </span>
<span id="cb176-6"><a href="developing.html#cb176-6"></a>    <span class="co"># Adding hexbins to the plot.</span></span>
<span id="cb176-7"><a href="developing.html#cb176-7"></a>    plot_cmds[[<span class="st">&quot;hex&quot;</span>]] &lt;-<span class="st"> &quot;geom_hex(aes(X, Y), plot.data) +&quot;</span></span>
<span id="cb176-8"><a href="developing.html#cb176-8"></a>    plot_cmds[[<span class="st">&quot;labs&quot;</span>]] &lt;-<span class="st"> &quot;labs(fill=&#39;Count&#39;) +&quot;</span></span>
<span id="cb176-9"><a href="developing.html#cb176-9"></a>    plot_cmds[[<span class="st">&quot;labs&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">sprintf</span>(</span>
<span id="cb176-10"><a href="developing.html#cb176-10"></a>        <span class="st">&quot;labs(x=&#39;%s&#39;, y=&#39;%s&#39;, title=&#39;%s&#39;, fill=&#39;%s&#39;) +&quot;</span>,</span>
<span id="cb176-11"><a href="developing.html#cb176-11"></a>        labels<span class="op">$</span>X, labels<span class="op">$</span>Y, labels<span class="op">$</span>title, <span class="st">&quot;Count&quot;</span></span>
<span id="cb176-12"><a href="developing.html#cb176-12"></a>        )</span>
<span id="cb176-13"><a href="developing.html#cb176-13"></a>    plot_cmds[[<span class="st">&quot;theme_base&quot;</span>]] &lt;-<span class="st"> &quot;theme_bw() +&quot;</span></span>
<span id="cb176-14"><a href="developing.html#cb176-14"></a>    plot_cmds[[<span class="st">&quot;theme_legend&quot;</span>]] &lt;-<span class="st"> &quot;theme(legend.position = &#39;bottom&#39;)&quot;</span></span>
<span id="cb176-15"><a href="developing.html#cb176-15"></a></span>
<span id="cb176-16"><a href="developing.html#cb176-16"></a>    <span class="co"># Adding a faceting command, if applicable.</span></span>
<span id="cb176-17"><a href="developing.html#cb176-17"></a>    facet_cmd &lt;-<span class="st"> </span><span class="kw">.addFacets</span>(x)</span>
<span id="cb176-18"><a href="developing.html#cb176-18"></a>    <span class="cf">if</span> (<span class="kw">length</span>(facet_cmd)) {</span>
<span id="cb176-19"><a href="developing.html#cb176-19"></a>        N &lt;-<span class="st"> </span><span class="kw">length</span>(plot_cmds)</span>
<span id="cb176-20"><a href="developing.html#cb176-20"></a>        plot_cmds[[N]] &lt;-<span class="st"> </span><span class="kw">paste</span>(plot_cmds[[N]], <span class="st">&quot;+&quot;</span>)</span>
<span id="cb176-21"><a href="developing.html#cb176-21"></a>        plot_cmds &lt;-<span class="st"> </span><span class="kw">c</span>(plot_cmds, facet_cmd)</span>
<span id="cb176-22"><a href="developing.html#cb176-22"></a>    }</span>
<span id="cb176-23"><a href="developing.html#cb176-23"></a></span>
<span id="cb176-24"><a href="developing.html#cb176-24"></a>    <span class="co"># Adding self-brushing boxes, if they exist.</span></span>
<span id="cb176-25"><a href="developing.html#cb176-25"></a>    plot_cmds &lt;-<span class="st"> </span><span class="kw">.addMultiSelectionPlotCommands</span>(x,</span>
<span id="cb176-26"><a href="developing.html#cb176-26"></a>        <span class="dt">envir=</span>envir, <span class="dt">commands=</span>plot_cmds)</span>
<span id="cb176-27"><a href="developing.html#cb176-27"></a></span>
<span id="cb176-28"><a href="developing.html#cb176-28"></a>    gg_plot &lt;-<span class="st"> </span><span class="kw">.textEval</span>(plot_cmds, envir)</span>
<span id="cb176-29"><a href="developing.html#cb176-29"></a></span>
<span id="cb176-30"><a href="developing.html#cb176-30"></a>    <span class="kw">list</span>(<span class="dt">plot=</span>gg_plot, <span class="dt">commands=</span>plot_cmds)</span>
<span id="cb176-31"><a href="developing.html#cb176-31"></a>})</span></code></pre></div>
<p>For brevity, we have omitted the more tiresome parts of coloring the bins with respect to assay values or metadata variables.
However, it is relatively straightforward to extend <code>.generateDotPlot()</code> to ensure that it responds to such choices as well as any other relevant parameters in <code>x</code> (e.g., font size).</p>
</div>
<div id="in-action" class="section level2">
<h2><span class="header-section-number">4.6</span> In action</h2>
<p>To demonstrate, we will load a small example dataset <span class="citation">(Tasic et al. <a href="#ref-tasic2016adult" role="doc-biblioref">2016</a>)</span> from the <em><a href="https://bioconductor.org/packages/3.11/scRNAseq">scRNAseq</a></em> package.
This is provided as a <code>SingleCellExperiment</code> on which we compute the usual <span class="math inline">\(t\)</span>-SNE plot.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="developing.html#cb177-1"></a><span class="kw">library</span>(scRNAseq)</span>
<span id="cb177-2"><a href="developing.html#cb177-2"></a>sce &lt;-<span class="st"> </span><span class="kw">ReprocessedAllenData</span>(<span class="dt">assays=</span><span class="st">&quot;tophat_counts&quot;</span>)</span>
<span id="cb177-3"><a href="developing.html#cb177-3"></a></span>
<span id="cb177-4"><a href="developing.html#cb177-4"></a><span class="kw">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb177-5"><a href="developing.html#cb177-5"></a><span class="kw">library</span>(scater)</span>
<span id="cb177-6"><a href="developing.html#cb177-6"></a>sce &lt;-<span class="st"> </span><span class="kw">logNormCounts</span>(sce, <span class="dt">exprs_values=</span><span class="st">&quot;tophat_counts&quot;</span>)</span>
<span id="cb177-7"><a href="developing.html#cb177-7"></a>sce &lt;-<span class="st"> </span><span class="kw">runPCA</span>(sce, <span class="dt">ncomponents=</span><span class="dv">4</span>)</span>
<span id="cb177-8"><a href="developing.html#cb177-8"></a>sce &lt;-<span class="st"> </span><span class="kw">runTSNE</span>(sce)</span></code></pre></div>
<p>We now set up an <code>iSEE()</code> instance with the hexbin and standard plots for showing reduced dimension results.
We can see the obvious visual differences in the aesthetics between plots as well as the changes to the user interface.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="developing.html#cb178-1"></a>app &lt;-<span class="st"> </span><span class="kw">iSEE</span>(sce, <span class="dt">initial=</span><span class="kw">list</span>(</span>
<span id="cb178-2"><a href="developing.html#cb178-2"></a>    <span class="kw">ReducedDimensionPlot</span>(<span class="dt">Type=</span><span class="st">&quot;TSNE&quot;</span>, <span class="dt">VisualBoxOpen=</span><span class="ot">TRUE</span>, <span class="dt">VisualChoices=</span><span class="st">&quot;Size&quot;</span>, <span class="dt">PanelWidth=</span>6L),</span>
<span id="cb178-3"><a href="developing.html#cb178-3"></a>    <span class="kw">RedDimHexPlot</span>(<span class="dt">Type=</span><span class="st">&quot;TSNE&quot;</span>, <span class="dt">VisualBoxOpen=</span><span class="ot">TRUE</span>, <span class="dt">VisualChoices=</span><span class="st">&quot;Size&quot;</span>, <span class="dt">PanelWidth=</span>6L)</span>
<span id="cb178-4"><a href="developing.html#cb178-4"></a>))</span></code></pre></div>
<p><img src="screenshots/hex-dimred.png" width="100%" /></p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-tasic2016adult">
<p>Tasic, B., V. Menon, T. N. Nguyen, T. K. Kim, T. Jarsky, Z. Yao, B. Levi, et al. 2016. “Adult mouse cortical cell taxonomy revealed by single cell transcriptomics.” <em>Nat. Neurosci.</em> 19 (2): 335–46.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="server.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dynamic-reduced-dimensions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["iSEE-book.pdf", "iSEE-book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
